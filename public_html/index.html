<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <div>

            <script>
                //a=setinterval(funcioSinParentesi,temps); cuando queramos dejar de hacer el proceso: clear interval(a);

                var row = "";
                var casilla = new Array(30);
                for (var i = 0; i < casilla.length; i++) {
                    casilla[i] = new Array(30);
                }
                crearMapa();

                /* Arriba: W
                 * Derecha: D
                 * Abajo: S
                 * Izquierda:A*/
                var fantasma1 = [];
                fantasma1 = crearPersonaje(fantasma1);
                var fantasma2 = [];
                fantasma2 = crearPersonaje(fantasma2);
                var fantasma3 = [];
                fantasma3 = crearPersonaje(fantasma3);
//                var jugador = [28, 16, "", ""];
                var jugador = new Array(4);
                jugador = crearPersonaje(jugador);
                pintarPersonajes();
                setInterval(movimientoFantasma, 1000);


                function movimientoFantasma() {
                    var direcValidaF1 = false;
                    var direcValidaF2 = false;
                    var direcValidaF3 = false;
                    var direcValidaJ = false;
                    do {
                        direcValidaF1 = compruebaDireccionFantasma(fantasma1);
                        direcValidaF2 = compruebaDireccionFantasma(fantasma2);
                        direcValidaF3 = compruebaDireccionFantasma(fantasma3);
                        direcValidaJ = compruebaDireccionJugador(jugador);
                    } while (direcValidaF1 == false || direcValidaF2 == false || direcValidaF3 == false || direcValidaJ==false);

                    mover(fantasma1);
                    mover(fantasma2);
                    mover(fantasma3);
                    mover(jugador);


                }

                function mover(fantasma) {
                    switch (fantasma[2]) {
                        case 1:
                            fantasma[0] -= 1;
                            document.body.innerHTML = "";
                            crearMapa();
                            pintarPersonajes();
                            break;
                            
                            case 2:
                            fantasma[1] += 1;
                            document.body.innerHTML = "";
                            crearMapa();
                            pintarPersonajes();
                            break;
                            
                            case 3:
                            fantasma[0] += 1;
                            document.body.innerHTML = "";
                            crearMapa();
                            pintarPersonajes();
                            break;
                            
                            case 4:
                            fantasma[1] -= 1;
                            document.body.innerHTML = "";
                            crearMapa();
                            pintarPersonajes();
                            break;
                            
                        default:

                            break;
                    }
                }
                
                function compruebaDireccionFantasma(fantasma) {
                    
                    switch (fantasma[2]) {
                        case 1:
                            if (casilla[fantasma[0] - 1][fantasma[1]] == 1||casilla[fantasma[0] - 1][fantasma[1]] == casilla[jugador[0]][jugador[1]]) {
                                return true;
                            } else {
                                fantasma[2] = Math.floor(Math.random() * 4) + 1;
                                return false;
                            }
                            break;

                        case 2:
                            if (casilla[fantasma[0]][fantasma[1] + 1] == 1||casilla[fantasma[0]][fantasma[1+1]] == casilla[jugador[0]][jugador[1]]) {
                                return true;
                            } else {
                                fantasma[2] = Math.floor(Math.random() * 4) + 1;
                                return false;
                            }
                            break;

                        case 3:
                            if (casilla[fantasma[0] + 1][fantasma[1]] == 1||casilla[fantasma[0] + 1][fantasma[1]] == casilla[jugador[0]][jugador[1]]) {
                                return true;
                            } else {
                                fantasma[2] = Math.floor(Math.random() * 4) + 1;
                                return false;
                            }
                            break;

                        case 4:
                            if (casilla[fantasma[0]][fantasma[1] - 1] == 1||casilla[fantasma[0]][fantasma[1]-1] == casilla[jugador[0]][jugador[1]]) {
                                return true;
                            } else {
                                fantasma[2] = Math.floor(Math.random() * 4) + 1;
                                return false;
                            }
                            break;

                        default:
                            alert("no entro");
                            break;
                    }

                }

                function compruebaDireccionJugador(jugador) {

                    switch (jugador[2]) {
                        case 1:
                            if (casilla[jugador[0] - 1][jugador[1]] != 0) {
                                return true;
                            } else {
                                jugador[2] = Math.floor(Math.random() * 4) + 1;
                                return false;
                            }
                            break;

                        case 2:
                            if (casilla[jugador[0]][jugador[1] + 1] != 0) {
                                return true;
                            } else {
                                jugador[2] = Math.floor(Math.random() * 4) + 1;
                                return false;
                            }
                            break;

                        case 3:
                            if (casilla[jugador[0] + 1][jugador[1]] != 0) {
                                return true;
                            } else {
                                jugador[2] = Math.floor(Math.random() * 4) + 1;
                                return false;
                            }
                            break;

                        case 4:
                            if (casilla[jugador[0]][jugador[1] - 1] != 0) {
                                return true;
                            } else {
                                jugador[2] = Math.floor(Math.random() * 4) + 1;
                                return false;
                            }
                            break;

                        default:
                            alert("no entro");
                            break;
                    }

                }



                function crearPersonaje(personaje) {
                    var fila = 0;
                    var columna = 0;
                    creado = false;

                    var direccio = 0;


                    do {
                        fila = Math.floor((Math.random() * 29) + 0);
                        columna = Math.floor((Math.random() * 29) + 0);

                    } while (casilla[fila][columna] == 0);

                    do {
                        var num = Math.floor((Math.random() * 4) + 1);
                        switch (num) {
                            case 1:
                                if (casilla[fila - 1][columna] == 1) {
                                    direccio = 1;
                                    creado = true;
                                } else {
                                    creado = false;
                                }
                                break;
                            case 2:
                                if (casilla[fila][columna + 1] == 1) {
                                    direccio = 2;
                                    creado = true;
                                } else {
                                    creado = false;
                                }
                                break;

                            case 3:
                                if (casilla[fila + 1][columna] == 1) {
                                    direccio = 3;
                                    creado = true;
                                } else {
                                    creado = false;
                                }
                                break;

                            case 4:
                                if (casilla[fila][columna - 1] == 1) {
                                    direccio = 4;
                                    creado = true;
                                } else {
                                    creado = false
                                }
                                break;

                            default :
                                alert(num + "</br>");

                                break;

                        }


                    } while (creado == false)

                    if (personaje.length == 4) {
                        personaje = [fila, columna, direccio, direccio];

                    } else {
                        personaje = [fila, columna, direccio];
                    }





                    return personaje;
                }

                function pintarPersonajes() {

                    for (var i = 0; i < casilla.length; i++) {
                        for (var j = 0; j < casilla[i].length; j++) {

                            if (fantasma1[0] == i && fantasma1[1] == j) {
                                casilla[i][j] = "<strong>F</strong> ";
                            }
                            if (fantasma2[0] == i && fantasma2[1] == j) {
                                casilla[i][j] = "<strong>A</strong> ";
                            }
                            if (fantasma3[0] == i && fantasma3[1] == j) {
                                casilla[i][j] = "<strong>H</strong> ";
                            }
                            if (jugador[0] == i && jugador[1] == j) {
                                casilla[i][j] = "<strong>J </strong>";
                            }

                            document.write(casilla[i][j] + " ");
                        }
                        document.write("</br>");

                    }
                    document.writeln("Posiciones iniciales: </br>")
                    document.writeln("Fantasma1: " + fantasma1);
                    document.writeln("</br>")
                    document.writeln("Fantasma2: " + fantasma2);
                    document.writeln("</br>")
                    document.writeln("Fantasma3: " + fantasma3);
                    document.writeln("</br>")
                    document.writeln("Jugador: " + jugador);
                }







                function crearMapa() {
                    casilla = [
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0],
                        [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0],
                        [0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0],
                        [0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0],
                        [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0],
                        [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
                        [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
                        [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

                    ];
                }




            </script>
        </div>

    </body>
</html>